@{
    ViewBag.Title = "Tax Rule Configuration";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
    :root {
        --primary: #0f172a; /* Slate 900 */
        --accent: #2563eb; /* Royal Blue */
        --accent-hover: #1d4ed8;
        --bg-body: #f1f5f9; /* Slate 100 */
        --text-main: #334155; /* Slate 700 */
        --text-muted: #64748b; /* Slate 500 */
        --border-color: #e2e8f0; /* Slate 200 */
    }

    body {
        font-family: 'Inter', sans-serif;
        background: var(--bg-body);
        color: var(--text-main);
    }

    /* --- OVERRIDE PANEL TO LOOK MODERN --- */
    .panel {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        border: none;
        margin-bottom: 20px;
    }

    .panel-heading {
        background: #fff;
        border-bottom: 1px solid var(--border-color);
        padding: 20px 24px;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .panel-title {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        color: var(--primary);
        font-size: 16px;
        margin: 0;
    }

    .panel-body {
        padding: 0; /* Remove padding to let table hit edges */
    }

    /* --- MODERN TABLE --- */
    .table-modern {
        width: 100%;
        margin-bottom: 0;
    }

        .table-modern thead th {
            background: #f8fafc;
            color: var(--text-muted);
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border-color);
            border-top: none;
        }

        .table-modern tbody td {
            padding: 16px 24px;
            vertical-align: middle;
            border-top: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-main);
        }

        .table-modern tbody tr:hover {
            background-color: #f8fafc;
        }

    /* --- BADGES --- */
    .badge-pill {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        border-radius: 99px;
        font-size: 11px;
        font-weight: 600;
    }

    .badge-gray {
        background: #f1f5f9;
        color: #475569;
    }

    .badge-blue {
        background: #eff6ff;
        color: #2563eb;
    }

    .badge-green {
        background: #f0fdf4;
        color: #16a34a;
    }

    .badge-amber {
        background: #fffbeb;
        color: #d97706;
    }

    .badge-red {
        background: #fef2f2;
        color: #dc2626;
    }

    /* --- BUTTONS --- */
    .btn-modern-primary {
        background: var(--accent);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        transition: 0.2s;
    }

        .btn-modern-primary:hover {
            background: var(--accent-hover);
            color: white;
            text-decoration: none;
        }

    .btn-icon {
        width: 32px;
        height: 32px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        color: var(--text-muted);
        background: white;
        transition: 0.2s;
    }

        .btn-icon:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

    /* --- PAGINATION & FOOTER --- */
    .grid-footer {
        padding: 16px 24px;
        border-top: 1px solid var(--border-color);
        background: #fff;
        border-radius: 0 0 8px 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .pagination-modern {
        margin: 0;
        display: flex;
        list-style: none;
        padding: 0;
        gap: 4px;
    }

        .pagination-modern li a {
            display: block;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            color: var(--text-main);
            font-size: 12px;
            text-decoration: none;
            transition: 0.2s;
        }

        .pagination-modern li.active a {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .pagination-modern li a:hover:not(.active) {
            background: #f1f5f9;
        }

        .pagination-modern li.disabled a {
            opacity: 0.5;
            pointer-events: none;
        }

    /* --- MODAL INPUTS --- */
    .form-control-modern {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 13px;
        color: var(--text-main);
    }

        .form-control-modern:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
        }

    /* RADIO CARDS */
    .radio-card-group {
        display: flex;
        gap: 10px;
    }

    .radio-card {
        flex: 1;
        cursor: pointer;
        position: relative;
    }

        .radio-card input {
            position: absolute;
            opacity: 0;
        }

        .radio-card .card-content {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: 0.2s;
            background: #fff;
        }

        .radio-card input:checked + .card-content {
            border-color: var(--accent);
            background: #eff6ff;
            color: var(--accent);
        }
</style>

<section role="main" class="content-body">

    <header class="page-header">
        <h2 style="font-weight:700; color: var(--primary); margin-top: 10px;">Tax Rule Configuration</h2>
        <p class="text-muted" style="font-size:13px; margin-bottom: 20px;">Manage deductions, exemptions, and tax slab definitions.</p>
    </header>

    <section class="panel">

        <header class="panel-heading">
            <h2 class="panel-title">
                <i class="fa fa-layer-group text-primary mr-2"></i> Active Tax Rules
            </h2>
            <button class="btn btn-modern-primary" onclick="openRuleModal()">
                <i class="fa fa-plus-circle"></i> Add Rule
            </button>
        </header>

        <div class="panel-body">

            <div class="table-responsive">
                <table class="table table-modern mb-none">
                    <thead>
                        <tr>
                            <th>FY</th>
                            <th>Regime</th>
                            <th>Section</th>
                            <th>Rule Name</th>
                            <th>Mapping Strategy</th>
                            <th>Max Limit</th>
                            <th>Status</th>
                            <th class="text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span style="font-weight:600;">2025-26</span></td>
                            <td><span class="badge-pill badge-gray">OLD REGIME</span></td>
                            <td>
                                <div style="font-weight:600;">80C</div>
                                <span class="badge-pill badge-red" style="font-size:9px; padding:2px 6px;">DEDUCTION</span>
                            </td>
                            <td>
                                <div style="font-weight:600; color:var(--primary);">Employee PF Contribution</div>
                                <div class="text-muted" style="font-size:11px;">Code: PF_EE_80C</div>
                            </td>
                            <td>
                                <span class="badge-pill badge-green">
                                    <i class="fa fa-link mr-1"></i> PAYROLL
                                </span>
                            </td>
                            <td style="font-family: monospace;">₹ 1,50,000</td>
                            <td><i class="fa fa-circle text-success" style="font-size:8px;"></i></td>
                            <td class="text-right">
                                <button class="btn-icon" onclick="openRuleModal()" title="Edit">
                                    <i class="fa fa-pen"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><span style="font-weight:600;">2025-26</span></td>
                            <td><span class="badge-pill badge-blue">NEW REGIME</span></td>
                            <td>
                                <div style="font-weight:600;">80CCD(2)</div>
                                <span class="badge-pill badge-green" style="font-size:9px; padding:2px 6px;">EXEMPTION</span>
                            </td>
                            <td>
                                <div style="font-weight:600; color:var(--primary);">National Pension Scheme</div>
                                <div class="text-muted" style="font-size:11px;">Code: NPS_ER</div>
                            </td>
                            <td>
                                <span class="badge-pill badge-amber">
                                    <i class="fa fa-keyboard mr-1"></i> MANUAL
                                </span>
                            </td>
                            <td style="font-family: monospace;">--</td>
                            <td><i class="fa fa-circle text-success" style="font-size:8px;"></i></td>
                            <td class="text-right">
                                <button class="btn-icon" onclick="openRuleModal()" title="Edit">
                                    <i class="fa fa-pen"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="grid-footer">
                <div class="text-muted" style="font-size: 12px;">
                    Showing <strong>1</strong> to <strong>10</strong> of <strong>32</strong> entries
                </div>
                <div>
                    <ul class="pagination-modern">
                        <li class="disabled"><a href="#"><i class="fa fa-chevron-left"></i></a></li>
                        <li class="active"><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#"><i class="fa fa-chevron-right"></i></a></li>
                    </ul>
                </div>
            </div>

        </div>
    </section>
</section>

<div class="modal fade" id="taxRuleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border:none; border-radius:12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);">

            <div class="modal-header" style="background:#fff; border-bottom:1px solid #e2e8f0; padding:20px 25px; border-radius:12px 12px 0 0;">
                <button type="button" class="close" data-dismiss="modal" style="font-size:24px; color:#94a3b8; outline:none;">&times;</button>
                <h4 class="modal-title" style="font-weight:700; color:var(--primary); margin:0;">Configure Rule</h4>
            </div>

            <div class="modal-body" style="padding: 25px; background:#fff;">

                <div class="row" style="margin-bottom:15px;">
                    <div class="col-md-3">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Fiscal Year</label>
                        <select class="form-control-modern"><option>2025-26</option></select>
                    </div>
                    <div class="col-md-3">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Regime</label>
                        <select class="form-control-modern" onchange="loadSlabAndConstant()"><option>Old Regime</option><option>New Regime</option></select>
                    </div>
                    <div class="col-md-3">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Section</label>
                        <select class="form-control-modern"><option>80C</option><option>80D</option></select>
                    </div>
                    <div class="col-md-3">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Code</label>
                        <input class="form-control-modern" placeholder="e.g. PF_EE_80C">
                    </div>
                </div>

                <div class="row" style="margin-bottom:25px;">
                    <div class="col-md-8">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Rule Name</label>
                        <input class="form-control-modern" placeholder="e.g. Employee Provident Fund">
                    </div>
                    <div class="col-md-4">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Max Limit</label>
                        <input class="form-control-modern" placeholder="150000">
                    </div>
                </div>

                <label class="control-label text-muted" style="font-size:11px; font-weight:700; text-transform:uppercase;">Calculation Strategy</label>
                <div class="radio-card-group" style="margin-bottom:15px;">
                    <label class="radio-card">
                        <input type="radio" name="mapType" checked onclick="toggleMapping('PAYROLL')">
                        <div class="card-content">
                            <i class="fa fa-link text-success"></i><br>
                            <span style="font-size:12px; font-weight:600;">Payroll</span>
                        </div>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="mapType" onclick="toggleMapping('MANUAL')">
                        <div class="card-content">
                            <i class="fa fa-keyboard text-primary"></i><br>
                            <span style="font-size:12px; font-weight:600;">Manual</span>
                        </div>
                    </label>
                    <label class="radio-card">
                        <input type="radio" name="mapType" onclick="toggleMapping('STATUTORY')">
                        <div class="card-content">
                            <i class="fa fa-gavel text-warning"></i><br>
                            <span style="font-size:12px; font-weight:600;">Statutory</span>
                        </div>
                    </label>
                </div>

                <div id="payrollBox" style="background:#f0fdf4; padding:15px; border-radius:8px; border:1px solid #bbf7d0; display:block;">
                    <label class="control-label text-success" style="font-weight:600; font-size:12px;">Linked Salary Component</label>
                    <select class="form-control-modern" style="border-color:#86efac;">
                        <option>Basic Salary</option>
                        <option>PF Employee Share</option>
                    </select>
                </div>

                <hr style="margin: 25px 0;">

                <div class="row">
                    <div class="col-md-6" style="border-right:1px solid #e2e8f0;">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Tax Slabs (Auto)</label>
                        <table class="table table-bordered table-condensed table-striped" style="font-size:11px; margin-bottom:0;">
                            <thead><tr><th>From</th><th>To</th><th>%</th></tr></thead>
                            <tbody id="taxSlabBody"></tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <label class="control-label" style="font-size:12px; font-weight:600;">Constants</label>
                        <div class="row">
                            <div class="col-xs-6 mb-sm"><input class="form-control-modern input-sm" readonly id="txtCess" placeholder="Cess"></div>
                            <div class="col-xs-6 mb-sm"><input class="form-control-modern input-sm" readonly id="txtStdDeduction" placeholder="Std Ded"></div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="modal-footer" style="background:#f8fafc; border-top:1px solid #e2e8f0; padding:15px 25px; border-radius:0 0 12px 12px;">
                <button class="btn btn-default" data-dismiss="modal" style="border:1px solid #cbd5e1; background:#fff; color:#475569;">Cancel</button>
                <button class="btn btn-modern-primary">Save Configuration</button>
            </div>

        </div>
    </div>
</div>

<script>
    function openRuleModal() {
        $('#taxRuleModal').modal('show');
        loadSlabAndConstant();
    }

    function toggleMapping(type) {
        // Simple toggle logic (expand as needed)
        if (type === 'PAYROLL') $('#payrollBox').show();
        else $('#payrollBox').hide();
    }

    function loadSlabAndConstant() {
        $('#taxSlabBody').html(`
            <tr><td>0</td><td>4L</td><td>0%</td></tr>
            <tr><td>4L</td><td>8L</td><td>5%</td></tr>
            <tr><td>8L</td><td>12L</td><td>10%</td></tr>
        `);
        $('#txtCess').val('4%');
        $('#txtStdDeduction').val('75k');
    }
</script>